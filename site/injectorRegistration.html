<!DOCTYPE html>
<html lang="en">
<!--this page is for registering a new injector-->
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Injector Registration</title>
	<link rel="stylesheet" href="styles/style.css">
	<link rel="stylesheet" href="styles/homePageStyles.css">
</head>
<body>

	<div class="container"> 
		<form id="newInjectorForm" onsubmit="validateForm(event)">
			<h2>Injector Information</h2>
			<label for="firstName">First name:</label><br>
			<input type="text" id="firstName" name="firstName"  /><br>

			<label for="lastName">Last name:</label><br>
			<input type="text" id="lastName" name="lastName"  /><br>

			<label for="siteID">Clinic ID:</label><br>
			<input type="number" id="siteID" name="clinicID" min="1" /><br>
			<br><br>
			<input type="submit" value="register" id="newInjectorFormSubmit">
		</form>
		<p id="injMsg">New injector was successfully registered. Please return to the <a href="http://localhost:8081/accounthome">injector homepage</a>.</p>
	</div>
		
		<script>
			// commented out for javascript validation testing  
	
			// 		form.addEventListener("submit", function(){
				//	alert("Success!");
				//});
			const newInjectorForm = document.forms["newInjectorForm"];
			const injMsg=document.getElementById("injMsg");
			const originalInjMsg=injMsg.innerHTML;
			injMsg.hidden=true;

			function validateForm(event) {
				event.preventDefault();

                var regName = /^[A-Za-z\s]+$/;
                const firstName = newInjectorForm["firstName"].value;
                if (firstName == "") {
                    alert("First name must be filled out");
                    return false;
				}
				if (!regName.test(firstName)) {
					alert("Invalid first name given");
                }

                const lastName = newInjectorForm["lastName"].value;
				if (lastName == "") {
					alert("Last name must be filled out");
					return false;
				}
				if (!regName.test(lastName)) {
                    alert("Invalid last name given");
                }

                const clinicID = newInjectorForm["clinicID"].value;
				if (clinicID == "") {
					alert("ClinicID must be filled out");
					return false;
				}
                if (clinicID.match(/\D/.test(clinicID))){
					alert("Please only enter numeric characters only for your ClinicID");
					return false;
				}

				const data = new FormData(newInjectorForm);
                const value = Object.fromEntries(data.entries());

				fetch("http://localhost:8081/addinjector", {
                         method: "POST",
                         headers: {
                             "Content-Type": "application/json"
                         },
                         body: JSON.stringify(value)
                     })
                     .then(function (response) {
                         console.log(response);
                         return response.json();
                     })
                     .then(function (data) {
                         console.log(data);
 
                         if (data == "success") { //display success message
                             injMsg.innerHTML = originalInjMsg;
                             injMsg.hidden = false;
                             newInjectorForm.hidden=true;
                         }
                         else { //set message content to error from server - probably won't get called bc validation catches potential errors
                             injMsg.textContent = data;
                             injMsg.hidden = false;
                         }
                 });
            }
			
		</script>
</body>
</html>